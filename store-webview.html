<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop - Briing</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="no-scroll">
    <header class="top-nav webview-header">
        <a href="all-stores.html" class="back-button"><i class="fas fa-arrow-left"></i></a>
        <h1 id="store-name">Store</h1>
        <a href="product-link.html" class="cart-button"><i class="fas fa-shopping-cart"></i></a>
    </header>

    <div class="webview-notice">
        <p>Some sites may not load. If the page is blank, <a id="direct-link" href="#" target="_blank">open it in a new tab</a>.</p>
    </div>

    <main class="webview-container">
        <iframe id="store-iframe" src="" frameborder="0"></iframe>
        <div id="fallback-container" class="fallback-container" style="display: none;">
            <h2>Unable to Load Store</h2>
            <p>This store's website doesn't allow being embedded here.</p>
            <p>To continue creating your order, please download our mobile app.</p>
            <div class="app-buttons">
                <a href="https://apps.apple.com/app/apple-store/idYOUR_APP_ID" class="app-store-btn">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3c/Download_on_the_App_Store_Badge.svg/2560px-Download_on_the_App_Store_Badge.svg.png" alt="App Store">
                </a>
                <a href="https://play.google.com/store/apps/details?id=YOUR_PACKAGE_NAME" class="google-play-btn">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/78/Google_Play_Store_badge_EN.svg/2560px-Google_Play_Store_badge_EN.svg.png" alt="Google Play">
                </a>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const storeUrl = params.get('url');
            const storeName = params.get('name');
            
            const iframe = document.getElementById('store-iframe');
            const fallbackContainer = document.getElementById('fallback-container');
            const webviewNotice = document.querySelector('.webview-notice');

            if (storeUrl) {
                iframe.src = storeUrl;
                document.getElementById('direct-link').href = storeUrl;

                // Attempt to detect if the iframe failed to load
                let loadSuccess = true;
                iframe.onload = () => {
                    try {
                        // Accessing contentWindow will throw a cross-origin error if the page blocked framing
                        if (iframe.contentWindow.location.href) {
                           // This part may not execute if the page is truly cross-origin and just loaded.
                           // The real check is the catch block.
                        }
                    } catch (e) {
                        loadSuccess = false;
                        iframe.style.display = 'none';
                        webviewNotice.style.display = 'none';
                        fallbackContainer.style.display = 'flex';
                    }
                };
                
                // A simple timeout fallback in case onload doesn't fire reliably for blocked frames
                setTimeout(() => {
                    if (!loadSuccess) {
                         iframe.style.display = 'none';
                         webviewNotice.style.display = 'none';
                         fallbackContainer.style.display = 'flex';
                    }
                }, 2000); // 2 seconds delay

            }
            if (storeName) {
                document.getElementById('store-name').textContent = storeName;
                document.title = `${storeName} - Briing`;
            }
        });
    </script>
</body>
</html>
